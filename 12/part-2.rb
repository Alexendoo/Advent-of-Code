p IO.read('input').gsub(/{(?>[^{}:]+|[^{}]+?|({(?>[^{}]+|\g'1')*}))*:"red(?>[^{}]+|\g'1')*}/, '').scan(/-?\d+/).map(&:to_i).reduce(:+)
